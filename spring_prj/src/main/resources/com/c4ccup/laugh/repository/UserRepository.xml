<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.c4ccup.laugh.repository.UserRepository">

  <resultMap id="UserResultMap" type="com.c4ccup.laugh.domain.User">
    <id column="user_id" property="id" />
    <result column="mail_address" property="mail"/>
    <result column="user_name" property="userName"/>
    <result column="user_name_kana" property="userNameKana"/>
    <result column="user_type" property="userType"/>
    <result column="password" property="password"/>
    <result column="debut_dt" property="debutDt"/>
    <result column="gender" property="gender"/>
    <result column="self_introduction" property="selfIntoroduction"/>
    <result column="profile_img_path" property="porfileImg"/>
    <result column="delete_flg" property="deleteFlg"/>
    <result column="login_at" property="loginAt"/>
    <result column="create_at" property="createAt"/>
    <result column="update_at" property="updateAt"/>
    <result column="special_skill_ids" property="specialSkillIds"/>
    <result column="special_skill_names" property="specialSkillNames"/>
    <result column="another_skill_names" property="anotherSkillNames"/>
    <result column="comedy_style_ids" property="comedyStyleIds"/>
    <result column="comedy_style_names" property="comedyStyleNames"/>
    <association property="officeId" resultMap="OfficeResultMap"/>
    <association property="areaId" resultMap="AreaResultMap"/>
    <association property="composerProfile" resultMap="ComposerResultMap"/>
    <association property="comedianProfile" resultMap="ComedianResultMap"/>
  </resultMap>
    <resultMap id="OfficeResultMap" type="com.c4ccup.laugh.domain.Office">
	  <id column="office_id" property="id" />
	  <result column="office_name" property="officeName"/>
	  <result column="create_at" property="createAt"/>
	  <result column="update_at" property="updateAt"/>
    </resultMap>
    <resultMap id="AreaResultMap" type="com.c4ccup.laugh.domain.Area">
	  <id column="area_id" property="id" />
	  <result column="area" property="areaName"/>
	  <result column="create_at" property="createAt"/>
	  <result column="update_at" property="updateAt"/>
    </resultMap>
    <resultMap id="ComposerResultMap" type="com.c4ccup.laugh.domain.Composer">
	  <id column="id" property="id" />
	  <result column="user_id" property="userId"/>
	  <result column="fee_type" property="feeType"/>
	  <result column="fee" property="fee"/>
	  <result column="create_at" property="createAt"/>
	  <result column="update_at" property="updateAt"/>
	</resultMap>
	<resultMap id="ComedianResultMap" type="com.c4ccup.laugh.domain.Comedian">
	  <id column="id" property="id" />
	  <result column="user_id" property="userId"/>
	  <result column="member_num" property="memberNum"/>
	  <result column="create_at" property="createAt"/>
	  <result column="update_at" property="updateAt"/>
	</resultMap>
    <resultMap id="SpecialSkillResultMap" type="com.c4ccup.laugh.domain.SpecialSkill">
	  <id column="id" property="id" />
	  <result column="special_skill_name" property="specialSkillName"/>
	  <result column="create_at" property="createAt"/>
	  <result column="update_at" property="updateAt"/>
    </resultMap>
    <resultMap id="OwnSpecialSkillResultMap" type="com.c4ccup.laugh.domain.OwnSpecialSkill">
	  <id column="own_special_skill_id" property="id" />
	  <result column="user_id" property="userId"/>
	  <result column="another_skill" property="anotherSkillName"/>
	  <result column="create_at" property="createAt"/>
	  <result column="update_at" property="updateAt"/>
	  <association property="specialSkillId" resultMap="SpecialSkillResultMap"/>
    </resultMap>

  <select id="findById" parameterType="int" resultMap="UserResultMap">
    SELECT
      *
    FROM
      user
    WHERE
      id = #{id}
  </select>

  <select id="findByMail" parameterType="String" resultMap="UserResultMap">
    SELECT
      *
    FROM
      user
    WHERE
      user_address = #{mail}
  </select>

  <select id="initByid" parameterType="int" resultMap="UserResultMap">
    SELECT
      *
    FROM
      user
    WHERE
      user_type != #{userType}
  </select>
  
  <select id="init" parameterType="int" resultMap="UserResultMap">
    SELECT
      *
    FROM
      User
  </select>

  <select id="getComposerList" parameterType="int" resultMap="UserResultMap">
    SELECT
      user.id as user_id
      ,user.user_address
      ,user.user_name
      ,user.user_name_kana
      ,user.user_type
      ,user.debut_dt
      ,user.gender
      ,user.office_id
      ,user.area_id
      ,user.self_introduction
      ,user.profile_img_path
      ,user.login_at
      ,user.create_at
      ,user.update_at
      ,composer_profile.fee_type
      ,composer_profile.fee
      ,office.id as office_id
      ,office.office_name
      ,area.id as area_id
      ,area.area
    FROM
      user
    LEFT JOIN
      composer_profile
    ON
      user.id = composer_profile.user_id
    LEFT JOIN
      office
    ON
      user.office_id = office.id
    LEFT JOIN
      area
    ON
      user.area_id = area.id
    WHERE
      user.user_type = #{userType}
    AND
      user.delete_flg = 0
  </select>

  <select id="getComedianList" parameterType="int" resultMap="UserResultMap">
    SELECT
      user.id as user_id
      ,user.user_address
      ,user.user_name
      ,user.user_name_kana
      ,user.user_type
      ,user.debut_dt
      ,user.gender
      ,user.office_id
      ,user.area_id
      ,user.self_introduction
      ,user.profile_img_path
      ,user.login_at
      ,user.create_at
      ,user.update_at
      ,comedian_profile.member_num
      ,office.id as office_id
      ,office.office_name
      ,area.id as area_id
      ,area.area
    FROM
      user
    LEFT JOIN
      comedian_profile
    ON
      user.id = comedian_profile.user_id
    LEFT JOIN
      office
    ON
      user.office_id = office.id
    LEFT JOIN
      area
    ON
      user.area_id = area.id
    WHERE
      user.user_type = #{userType}
    AND
      user.delete_flg = 0
  </select>
  <select id="getOwnSpecialSkillList2" resultMap="UserResultMap">
    SELECT
      user.id,
      GROUP_CONCAT(DISTINCT special_skill.id order by special_skill.id ASC) as special_skill_ids,
      GROUP_CONCAT(DISTINCT special_skill.special_skill_name ORDER BY special_skill.id ASC) AS special_skill_names,
      GROUP_CONCAT(own_special_skill.another_skill) as another_skill_names
    FROM
      user
    RIGHT JOIN
      own_special_skill
    ON
      user.id = own_special_skill.user_id
    LEFT JOIN
      special_skill
    ON
      special_skill.id = own_special_skill.special_skill_id
    GROUP BY 
      user.id 
  </select>
  <select id="getComposerList2" parameterType="int" resultMap="UserResultMap">
    SELECT
      user.id as user_id
      ,user.user_address
      ,user.user_name
      ,user.user_name_kana
      ,user.user_type
      ,user.debut_dt
      ,user.gender
      ,user.office_id
      ,user.area_id
      ,user.self_introduction
      ,user.profile_img_path
      ,user.login_at
      ,user.create_at
      ,user.update_at
      ,composer_profile.fee_type
      ,composer_profile.fee
      ,office.office_name
      ,area.area
      ,GROUP_CONCAT(DISTINCT special_skill.id order by special_skill.id ASC) as special_skill_ids
      ,GROUP_CONCAT(DISTINCT special_skill.special_skill_name order by special_skill.id ASC) as special_skill_names
      ,GROUP_CONCAT(DISTINCT own_special_skill.another_skill order by own_special_skill.special_skill_id ASC) as another_skill_names
      ,GROUP_CONCAT(DISTINCT comedy_style.id order by comedy_style.id ASC) as comedy_style_ids
      ,GROUP_CONCAT(DISTINCT comedy_style.style_name  order by comedy_style.id ASC) as comedy_style_names
    FROM
      user
    INNER JOIN
      composer_profile
    ON
      user.id = composer_profile.user_id
    LEFT JOIN
      office
    ON
      user.office_id = office.id
    LEFT JOIN
      area
    ON
      user.area_id = area.id
    LEFT JOIN
      own_special_skill
    ON
      user.id = own_special_skill.user_id
    LEFT JOIN
      special_skill
    ON
      special_skill.id = own_special_skill.special_skill_id
    LEFT JOIN
      own_comedy_style
    ON
      user.id = own_comedy_style.user_id
    LEFT JOIN
      comedy_style
    ON
      comedy_style.id = own_comedy_style.comedy_style_id
    WHERE
      user.user_type = #{userType}
    AND
      user.delete_flg = 0
    GROUP BY
      composer_profile.id
  </select>
  <select id="getComedianList2" parameterType="int" resultMap="UserResultMap">
    SELECT
      user.id as user_id
      ,user.user_address
      ,user.user_name
      ,user.user_name_kana
      ,user.user_type
      ,user.debut_dt
      ,user.gender
      ,user.office_id
      ,user.area_id
      ,user.self_introduction
      ,user.profile_img_path
      ,user.login_at
      ,user.create_at
      ,user.update_at
      ,comedian_profile.member_num
      ,office.office_name
      ,area.area
      ,GROUP_CONCAT(DISTINCT special_skill.id order by special_skill.id ASC) as special_skill_ids
      ,GROUP_CONCAT(DISTINCT special_skill.special_skill_name order by special_skill.id ASC) as special_skill_names
      ,GROUP_CONCAT(DISTINCT own_special_skill.another_skill order by own_special_skill.special_skill_id ASC) as another_skill_names
      ,GROUP_CONCAT(DISTINCT comedy_style.id order by comedy_style.id ASC) as comedy_style_ids
      ,GROUP_CONCAT(DISTINCT comedy_style.style_name  order by comedy_style.id ASC) as comedy_style_names
    FROM
      user
    INNER JOIN
      comedian_profile
    ON
      user.id = comedian_profile.user_id
    LEFT JOIN
      office
    ON
      user.office_id = office.id
    LEFT JOIN
      area
    ON
      user.area_id = area.id
    LEFT JOIN
      own_special_skill
    ON
      user.id = own_special_skill.user_id
    LEFT JOIN
      special_skill
    ON
      special_skill.id = own_special_skill.special_skill_id
    LEFT JOIN
      own_comedy_style
    ON
      user.id = own_comedy_style.user_id
    LEFT JOIN
      comedy_style
    ON
      comedy_style.id = own_comedy_style.comedy_style_id
    WHERE
      user.user_type = #{userType}
    AND
      user.delete_flg = 0
    GROUP BY
      comedian_profile.id
  </select>
</mapper>